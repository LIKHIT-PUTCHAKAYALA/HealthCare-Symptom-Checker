<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symptom AI - Modern Healthcare Symptom Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        html { scroll-behavior: smooth; overflow: hidden; } /* No page scroll */
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; overflow: hidden; }

        /* Hide all scrollbars */
        *::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }

        .prose { color: #9ca3af; } 
        .prose strong { color: #e5e7eb; } 
        .prose h1, .prose h2, .prose h3, .prose h4 { color: #e5e7eb; } 
        .prose ul > li::before { background-color: #22d3ee; }

        .tab-btn.active { color: #22d3ee; border-color: #22d3ee; background-color: rgba(14, 116, 144, 0.1); }

        #tabs-container { flex-wrap: nowrap; overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none; } 
        #tabs-container::-webkit-scrollbar { display: none; }

        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); } 
            20%, 80% { transform: translate3d(2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 
            40%, 60% { transform: translate3d(4px, 0, 0); } 
        }
        .shake-anim { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }

        .modal-scrollbar::-webkit-scrollbar { width: 6px; } 
        .modal-scrollbar::-webkit-scrollbar-track { background: #1e293b; } 
        .modal-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; } 
        .modal-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Custom select arrow */
        select { 
            -webkit-appearance: none; -moz-appearance: none; appearance: none; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); 
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; 
        }

        /* Reduce details box height */
        #results-container {
            min-height: 180px;
        }
    </style>
</head>
<body class="text-gray-300">
    <button id="history-btn" class="fixed top-6 right-6 p-3 rounded-full text-gray-400 hover:text-white hover:bg-slate-800 transition-colors z-20">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
    </button>
    <div class="min-h-screen w-full p-4 sm:p-6 lg:p-8">
        <main class="mx-auto max-w-7xl">
            <div class="text-center mb-8 flex items-center justify-center gap-4">
                 <svg class="h-10 w-10 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.785c0 1.135.845 2.098 1.976 2.192.39.033.78.052 1.174.052 1.423 0 2.848-.028 4.244-.082a2.25 2.25 0 002.162-2.317V10.608c0-1.135-.845-2.098-1.976-2.192A48.424 48.424 0 0012 8.25zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <h1 class="text-4xl md:text-5xl font-extrabold text-white">Healthcare Symptom Checker</h1>
            </div>
            <p class="text-center mt-[-1.5rem] mb-3 text-lg text-gray-400 max-w-3xl mx-auto">Describe your symptoms below to get an AI-powered analysis of probable conditions and recommendations.</p>
            <div class="flex justify-center mb-6"><div class="bg-sky-900/30 border border-sky-800 text-sky-200 px-3 py-2 rounded-lg flex items-center justify-center gap-2 text-sm inline-flex"><svg class="h-5 w-5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><p class="whitespace-nowrap text-center"><span class="font-bold">For Educational Purposes Only.</span> This tool does not provide medical diagnosis. In an emergency, call your local emergency number.</p></div></div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-slate-900/70 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-800 backdrop-blur-sm">
                    <h3 class="text-xl font-semibold text-white mb-4">Describe Your Symptoms</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="age-input" class="block text-sm font-medium text-gray-300 mb-1">Age</label>
                            <input type="number" id="age-input" class="w-full p-2 bg-slate-800/80 border border-slate-700 rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="enter age...">
                        </div>
                        <div>
                            <label for="gender-select" class="block text-sm font-medium text-gray-300 mb-1">Gender</label>
                            <select id="gender-select" class="w-full p-2 bg-slate-800/80 border border-slate-700 rounded-lg focus:ring-2 focus:ring-teal-500">
                                <option value="">Select...</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <textarea id="symptoms-input" rows="8" class="w-full p-4 bg-slate-800/80 border border-slate-700 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all duration-300 text-base placeholder-slate-400" placeholder="Be as detailed as possible..."></textarea>
                    <p id="error-message" class="text-red-500 text-sm mt-2 h-5"></p>
                    <button id="check-btn" class="w-full bg-gradient-to-r from-teal-500 to-cyan-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-teal-600 hover:to-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-teal-500 transition-all duration-300 shadow-lg hover:shadow-teal-500/50 mt-2 transform hover:-translate-y-1"><span id="btn-text">Analyze Symptoms</span></button>
                </div>
                <div id="results-container" class="bg-slate-900/70 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-800 backdrop-blur-sm min-h-[180px]">
                    <div id="initial-state" class="h-full flex flex-col justify-center items-center text-center text-gray-400"><svg class="h-16 w-16 mb-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.251.023.501.05.75.082a.75.75 0 01.75.75v5.714a2.25 2.25 0 00.659 1.591L19 14.5M9.75 3.104l.004-1.121a1.125 1.125 0 011.121-1.121h2.25a1.125 1.125 0 011.121 1.121V3.104m-2.25 0h2.25m-2.25 0h-2.25m15 11.25l-3.879-3.879m0 0a3.375 3.375 0 10-4.773-4.773 3.375 3.375 0 004.773 4.773z" /></svg><p>Your analysis results will appear here.</p></div>
                    <div id="loader" class="h-full hidden justify-center items-center flex-col space-y-4"><div class="flex justify-center items-center space-x-2"><div class="w-4 h-4 rounded-full bg-teal-500 animate-bounce"></div><div class="w-4 h-4 rounded-full bg-teal-500 animate-bounce" style="animation-delay: 0.2s;"></div><div class="w-4 h-4 rounded-full bg-teal-500 animate-bounce" style="animation-delay: 0.4s;"></div></div><p class="text-gray-400">AI is analyzing...</p></div>
                    <div id="results-content" class="hidden"><div id="emergency-level-container" class="mb-6 p-4 rounded-lg"></div><div class="border-b border-slate-700 mb-4"><nav id="tabs-container" class="flex" aria-label="Tabs"></nav></div><div id="tab-content-container" class="prose max-w-none"></div></div>
                </div>
            </div>
        </main>
    </div>
    <div id="history-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden items-center justify-center">
        <div id="history-modal-content" class="bg-slate-900 border border-slate-700 w-full max-w-2xl h-[80vh] rounded-2xl shadow-2xl flex flex-col p-6">
            <div class="flex justify-between items-center mb-4 pb-4 border-b border-slate-700"><h2 class="text-2xl font-bold text-white">Analysis History</h2><button id="close-history-btn" class="p-2 rounded-full text-gray-400 hover:text-white hover:bg-slate-800 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div>
            <div id="history-list" class="flex-grow overflow-y-auto modal-scrollbar"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkBtn = document.getElementById('check-btn'), btnText = document.getElementById('btn-text'),
                  symptomsInput = document.getElementById('symptoms-input'), loader = document.getElementById('loader'),
                  initialState = document.getElementById('initial-state'), resultsContent = document.getElementById('results-content'),
                  emergencyLevelContainer = document.getElementById('emergency-level-container'), tabsContainer = document.getElementById('tabs-container'),
                  tabContentContainer = document.getElementById('tab-content-container'), errorMessage = document.getElementById('error-message'),
                  historyBtn = document.getElementById('history-btn'), historyModal = document.getElementById('history-modal'),
                  closeHistoryBtn = document.getElementById('close-history-btn'), historyList = document.getElementById('history-list'),
                  ageInput = document.getElementById('age-input'), genderSelect = document.getElementById('gender-select');
            const tabConfig = [{ id: 'symptoms', title: 'Symptoms', key: 'given_symptoms' },{ id: 'causes', title: 'Possible Causes', key: 'possible_causes' },{ id: 'cure', title: 'Cure', key: 'cure' },{ id: 'precautions', title: 'Precautions', key: 'precautions_or_preventions' },{ id: 'advice', title: 'Expert Advice', key: 'expert_advice' }];
            const displayResults = (data) => {
                const levelText = data.emergency_level || "Not determined"; let levelColor = "gray";
                if (levelText.toLowerCase().includes('low')) levelColor = "green"; if (levelText.toLowerCase().includes('medium')) levelColor = "yellow"; if (levelText.toLowerCase().includes('high')) levelColor = "orange"; if (levelText.toLowerCase().includes('critical')) levelColor = "red";
                emergencyLevelContainer.className = `mb-6 p-4 rounded-lg bg-${levelColor}-900/40 text-${levelColor}-200 border border-${levelColor}-700`;
                emergencyLevelContainer.innerHTML = marked.parse(levelText);
                tabsContainer.innerHTML = ''; tabContentContainer.innerHTML = '';
                tabConfig.forEach((tab, index) => {
                    const button = document.createElement('button');
                    button.className = `tab-btn text-gray-400 hover:text-cyan-400 hover:border-slate-500 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm transition-all duration-300`;
                    button.textContent = tab.title; button.dataset.target = `#tab-panel-${tab.id}`; tabsContainer.appendChild(button);
                    const panel = document.createElement('div');
                    panel.id = `tab-panel-${tab.id}`; panel.className = 'tab-panel prose max-w-none';
                    panel.innerHTML = marked.parse(data[tab.key] || 'No information provided.'); tabContentContainer.appendChild(panel);
                    if (index === 0) { button.classList.add('active'); } else { panel.classList.add('hidden'); }
                });
                tabsContainer.querySelectorAll('.tab-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        tabsContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                        tabContentContainer.querySelectorAll('.tab-panel').forEach(panel => panel.classList.add('hidden'));
                        button.classList.add('active');
                        document.querySelector(button.dataset.target)?.classList.remove('hidden');
                    });
                });
            };
            checkBtn.addEventListener('click', async () => {
                const symptoms = symptomsInput.value.trim(), age = ageInput.value, gender = genderSelect.value;
                errorMessage.textContent = ''; symptomsInput.classList.remove('shake-anim');
                if (!symptoms || !age || !gender) { 
                    symptomsInput.parentElement.classList.add('shake-anim'); 
                    errorMessage.textContent = 'Please fill out all fields: Age, Gender, and Symptoms.'; 
                    setTimeout(() => symptomsInput.parentElement.classList.remove('shake-anim'), 820); return; 
                }
                initialState.classList.add('hidden'); resultsContent.classList.add('hidden'); loader.classList.remove('hidden'); loader.classList.add('flex'); checkBtn.disabled = true; btnText.textContent = "Analyzing...";
                try {
                    const response = await fetch(`${window.location.origin}/check_symptoms`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symptoms, age, gender }) });
                    if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || 'An unknown error occurred.'); }
                    const data = await response.json(); displayResults(data); resultsContent.classList.remove('hidden');
                } catch (error) { console.error('Error:', error); initialState.innerHTML = `<p class="text-red-500 font-semibold">Error: ${error.message}</p>`; initialState.classList.remove('hidden'); } 
                finally { loader.classList.add('hidden'); loader.classList.remove('flex'); checkBtn.disabled = false; btnText.textContent = "Analyze Symptoms"; }
            });
            const openHistoryModal = async () => {
                historyList.innerHTML = '<p class="text-gray-400">Loading history...</p>';
                historyModal.classList.remove('hidden'); historyModal.classList.add('flex');
                try {
                    const response = await fetch('/history');
                    const historyData = await response.json();
                    if (historyData.length === 0) { historyList.innerHTML = '<p class="text-gray-400 text-center mt-8">No analysis history found.</p>'; return; }
                    historyList.innerHTML = historyData.map(item => `
                        <div class="mb-4 p-4 bg-slate-800 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-700/50" 
                             data-symptoms='${item.symptoms}' 
                             data-age='${item.age}' 
                             data-gender='${item.gender}' 
                             data-analysis='${JSON.stringify(item.analysis)}'>
                            <p class="text-sm text-gray-400 mb-2">${item.timestamp}</p>
                            <p class="font-semibold text-white truncate pointer-events-none">${item.symptoms}</p>
                            <p class="text-xs text-gray-500 pointer-events-none">Age: ${item.age}, Gender: ${item.gender}</p>
                        </div>
                    `).join('');
                } catch (error) { historyList.innerHTML = '<p class="text-red-500">Failed to load history.</p>'; console.error("History fetch error:", error); }
            };
            const closeHistoryModal = () => { historyModal.classList.add('hidden'); historyModal.classList.remove('flex'); };
            historyBtn.addEventListener('click', openHistoryModal);
            closeHistoryBtn.addEventListener('click', closeHistoryModal);
            historyModal.addEventListener('click', (e) => { if (e.target === historyModal) { closeHistoryModal(); } });
            historyList.addEventListener('click', (e) => {
                const item = e.target.closest('[data-analysis]');
                if (item) {
                    symptomsInput.value = item.dataset.symptoms;
                    ageInput.value = item.dataset.age;
                    genderSelect.value = item.dataset.gender;
                    const analysisData = JSON.parse(item.dataset.analysis);
                    initialState.classList.add('hidden');
                    loader.classList.add('hidden');
                    resultsContent.classList.remove('hidden');
                    displayResults(analysisData);
                    closeHistoryModal();
                }
            });
        });
    </script>
</body>
</html>
